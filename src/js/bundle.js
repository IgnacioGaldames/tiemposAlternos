// notify.min.js, for SugarCube 2, by Chapel
;!function(){var n=/\d+m?s$/;function i(s,e,t){"string"==typeof s&&("number"!=typeof e&&(e=!1),$(document).trigger({type:":notify",message:s,delay:e,class:t||""}))}$(document.body).append("<div id='notify'></div>"),$(document).on(":notify",function(s){s.message&&"string"==typeof s.message&&(s.message.trim(),s.class?"string"==typeof s.class?s.class="open macro-notify "+s.class:Array.isArray(s.class)?s.class="open macro-notify "+s.class.join(" "):s.class="open macro-notify":s.class="open macro-notify",s.delay?("number"!=typeof s.delay&&(s.delay=Number(s.delay)),Number.isNaN(s.delay)&&(s.delay=2e3)):s.delay=2e3,$("#notify").empty().wiki(s.message).addClass(s.class),setTimeout(function(){$("#notify").removeClass()},s.delay))}),Macro.add("notify",{tags:null,handler:function(){var s=this.payload[0].contents,e=!1,t=!1;if(0<this.args.length){var a=n.test(this.args[0]);t="number"==typeof this.args[0]||a?(e=a?Util.fromCssTime(a):this.args[0],1<this.args.length&&this.args.slice(1).flatten()):this.args.flatten().join(" ")}i(s,e,t)}}),setup.notify=i}();
// end notify.min.js
// type-sim.min.js, for SugarCube 2, by Chapel
;Macro.add("typesim",{tags:null,handler:function(){var t=$(document.createElement("textarea")),e=$(document.createElement("div"));if(1!==this.args.length)return this.error("incorrect number of arguments");if("string"!=typeof this.args[0])return this.error("argument should be a string");var r=this.args[0],a="",n=r.length,i=0,s="typesim-output-"+r.replace(/[^A-Za-z0-9]/g,""),o="macro-"+this.name,d=this.payload[0].contents;t.wiki(a).attr({id:s,readonly:!0}).addClass(o).appendTo(this.output),$(document).on("keydown","#"+s,this.createShadowWrapper(function(t){i<n&&(a+=r.charAt(i),$("#"+s).empty().wiki(a)),i===n&&e.wiki(d).addClass(o).insertAfter("#"+s),i++}))}});
// end type-sim.min.js
// simple-inventory.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var c={tryGlobal:!0,defaultStrings:{empty:"The inventory is empty...",listDrop:"Discard",separator:"\n"}};function s(i,r,t,n){$(document).trigger({type:"initialized"===n?":inventory-init":":inventory-update",instance:i,receiving:r,moved:t,context:n})}function a(i){if(i=i?(i=[].slice.call(arguments)).flatten():[],!(this instanceof a))return new a(i);this.inv=i,s(this,null,i=i.length?i:null,"initialized")}Object.assign(a,{is:function(i){return i instanceof a},log:function(i){return a.is(i)?"Inventory.log() -> "+i.toArray().join(" - "):"Inventory.log() -> object is not an inventory..."},removeDuplicates:function(i){if(a.is(i)){var r,t=i.toArray();return r=[],t.forEach(function(i){r.includes(i)||r.push(i)}),r}}}),Object.assign(a.prototype,{transfer:function(i){if(arguments.length<2)return this;if(!a.is(i))return this;for(var r=[].slice.call(arguments),t=[],n=0,e=(r=r.slice(1).flatten()).length;n<e;n++)this.inv.includes(r[n])&&(this.inv.delete(r[n]),t.push(r[n]));return t.length&&(i.inv=i.inv.concat(t),s(this,i,t,"transfer")),this},has:function(){var i=[].slice.call(arguments).flatten();return!(!i||!i.length)&&this.inv.includesAny(i)},hasAll:function(){var i=[].slice.call(arguments).flatten();return!(!i||!i.length)&&this.inv.includesAll(i)},pickUp:function(i){var r,t=[].slice.call(arguments).flatten(),n=this;return t&&t.length&&("unique"!==i&&"unique"!==t[0]||(t=t.splice(1),r=[],t.forEach(function(i){n.inv.includes(i)||r.includes(i)||r.push(i)}),t=r),this.inv=this.inv.concat(t),s(this,null,t,"pickup")),this},drop:function(){var r,i=[].slice.call(arguments).flatten(),t=this;if(i&&i.length){var n=[];i.forEach(function(i){t.has(i)&&(n.push(i),r=t.inv.indexOf(i),t.inv.deleteAt(r))}),s(this,null,n,"drop")}return this},sort:function(){return this.inv=this.inv.sort(),s(this,null,null,"sort"),this},show:function(i){return i&&"string"==typeof i||(i=c.defaultStrings.separator),this.inv.length?this.inv.join(i):c.defaultStrings.empty},empty:function(){var i=clone(this.inv);return this.inv=[],s(this,null,i,"drop"),this},toArray:function(){return this.inv},count:function(r){if(r&&"string"==typeof r){var t=0;return this.toArray().forEach(function(i){i===r&&t++}),t}return this.toArray().length},isEmpty:function(){return 0===this.toArray().length},linkedList:function(o,l){o&&a.is(o)||(o=!1);var i=this.toArray(),h=this,u=$(document.createElement("span"));return i&&i.length?i.forEach(function(i,r,t){var n=$(document.createElement("span")),e=$(document.createElement("a")),s=l||c.defaultStrings.drop,a=function(i,r){var t=Math.random().toString(36).substring(7);return arguments.length<2&&(i=Math.random().toString(36).substring(7),r=random(99)),"simple-inv-"+r+"-"+Date.now()+"-"+i.replace(/[^A-Za-z0-9]/g,"")+"-"+t}(i,r);e.wiki(s).addClass("simple-inv drop-link"),e.ariaClick(function(){o?h.transfer(o,i):h.drop(i),$("#"+a).empty()}),n.attr("id",a).addClass("simple-inv link-listing").wiki(i+" ").append(e),r<t.length-1&&n.wiki("<br />"),u.append(n)}):u.wiki(c.defaultStrings.empty),u},constructor:a,toJSON:function(){return JSON.reviveWrapper("new setup.Inventory("+JSON.stringify(this.inv)+")")},clone:function(){return new a(this.inv)}}),setup.Inventory=a,setup.simpleInv={inventory:a},c.tryGlobal&&(window.Inventory=window.Inventory||a),Macro.add("newinventory",{handler:function(){if(this.args.length<1)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Wikifier.setValue(i,new a(this.args.slice(1).flatten()))}}),Macro.add("pickup",{handler:function(){if(this.args.length<2)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(i);if(!a.is(r))return this.error("variable "+i+" is not an inventory!");r.pickUp(this.args.slice(1).flatten())}}),Macro.add("drop",{handler:function(){if(this.args.length<2)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(i);if(!a.is(r))return this.error("variable "+i+" is not an inventory!");r.drop(this.args.slice(1).flatten())}}),Macro.add("transfer",{handler:function(){if(this.args.length<3)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(i);if(!a.is(r))return this.error("variable "+i+" is not an inventory!");var t=this.args[1].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');var n=Wikifier.getValue(t);if(!a.is(n))return this.error("variable "+t+" is not an inventory!");r.transfer(n,this.args.slice(2).flatten())}}),Macro.add("dropall",{handler:function(){if(1!==this.args.length)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(i);if(!a.is(r))return this.error("variable "+i+" is not an inventory!");r.empty()}}),Macro.add("clear","dropall",!1),Macro.add("sort",{handler:function(){if(1!==this.args.length)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(i);if(!a.is(r))return this.error("variable "+i+" is not an inventory!");r.sort()}}),Macro.add("inventory",{handler:function(){if(this.args.length<1||2<this.args.length)return this.error("incorrect number of arguments");var i=this.args[0].trim();if("$"!==i[0]&&"_"!==i[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Wikifier.getValue(i);if(!a.is(r))return this.error("variable "+i+" is not an inventory!");var t=$(document.createElement("span")),n=!!this.args[1]&&this.args[1];t.wiki(r.show(n)).addClass("macro-"+this.name).appendTo(this.output)}}),Macro.add("linkedinventory",{handler:function(){if(this.args.length<2||3<this.args.length)return this.error("incorrect number of arguments");var i=!1,r="",t=this.args[1].trim(),n="string"==typeof this.args[0]&&this.args[0];if(!n)return this.error("first argument should be the link text");if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[1]+'" is missing its sigil ($ or _)');var e=Util.slugify(t);e=this.name+"-"+e;var s=Wikifier.getValue(t);if(!a.is(s))return this.error("variable "+t+" is not an inventory!");if(2<this.args.length){if("$"!==(r=this.args[2].trim())[0]&&"_"!==r[0])return this.error('variable name "'+this.args[2]+'" is missing its sigil ($ or _)');if(i=Wikifier.getValue(r),!a.is(i))return this.error("variable "+r+" is not an inventory!")}s.linkedList(i,n).attr({id:e,"data-rec":r,"data-self":t,"data-action":n}).addClass("macro-"+this.name).appendTo(this.output)}})}();
// end simple-inventory.min.js
// mouseover.min.js, for SugarCube 2, by Chapel
;Macro.add("mouseover",{tags:["onhover","onmouseover","onmousein","onmouseenter","onmouseout"],skipArgs:!0,handler:function(){if(this.payload.length<2)return this.error("No event tag used.");var o={mouseover:[],mousein:[],mouseout:[]},e=$(document.createElement("span")).addClass("macro-"+this.name).wiki(this.payload[0].contents).appendTo(this.output);this.payload.forEach(function(e){switch(e.name){case"onhover":case"onmouseover":o.mouseover.push(e.contents);break;case"onmousein":case"onmouseenter":o.mousein.push(e.contents);break;case"onmouseout":o.mouseout.push(e.contents);break;default:return}}),o.mouseover.length&&e.on("mouseover",this.createShadowWrapper(function(e){$.wiki(o.mouseover.join(" "))})),o.mousein.length&&e.on("mouseenter",this.createShadowWrapper(function(e){$.wiki(o.mousein.join(" "))})),o.mouseout.length&&e.on("mouseout",this.createShadowWrapper(function(e){$.wiki(o.mouseout.join(" "))}))}});
// end mouseover.min.js
// cycles.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var e="%%cycles",t=!0,r="cycles.pause",i="cycles.pause.menu",s="cycles.postdisplay";function n(){return State.variables[e]}function a(e,t){if(!(this instanceof a))return new a(e,t);if(!e||"object"!=typeof e)throw new Error("Cycle() -> invalid definition object");if(!e.name||"string"!=typeof e.name||!e.name.trim())throw new Error("Cycle() -> invalid name");if(this.name=e.name,!e.phases||!Array.isArray(e.phases)||e.phases.length<2)throw new Error("Cycle() -> phases should be an array of at least two strings");if(!e.phases.every(function(e){return e&&"string"==typeof e&&e.trim()}))throw new Error("Cycle() -> each phase should be a valid, non-empty string");this.phases=clone(e.phases),e.period=Number(e.period),(Number.isNaN(e.period)||e.period<1)&&(e.period=1),Number.isInteger(e.period)||(e.period=Math.trunc(e.period)),this.period=e.period,e.increment=Number(e.increment),(Number.isNaN(e.increment)||e.increment<1)&&(e.increment=1),Number.isInteger(e.increment)||(e.increment=Math.trunc(e.increment)),this.increment=e.increment,this.active=void 0===e.active||!!e.active,t=Number(t),(Number.isNaN(t)||t<0)&&(t=0),Number.isInteger(t)||(t=Math.trunc(t)),this.stack=t}State.variables[e]={},Object.assign(a,{is:function(e){return e instanceof a},add:function(e,t){if(!t||"object"!=typeof t)throw new Error("Cycle.add() -> invalid definition object");if(e&&"string"==typeof e&&e.trim())t.name=e;else if(!t.name||"string"!=typeof t.name||!t.name.trim())throw new Error("Cycle.add() -> invalid name");var r=new a(t,0);return n()[t.name]=r},has:function(e){var t=n();return t.hasOwnProperty(e)&&a.is(t[e])},get:function(e){return a.has(e)?n()[e]:null},del:function(e){return!!a.has(e)&&(delete n()[e],!0)},clear:function(e){n()},_emit:function(e,t){$(document).trigger({type:":cycle-"+t,cycle:e})},_retrieveCycles:n}),Object.assign(a.prototype,{constructor:a,revive:function(){var t={};return Object.keys(this).forEach(function(e){t[e]=clone(this[e])},this),t},clone:function(){return new a(this.revive(),this.stack)},toJSON:function(){return JSON.reviveWrapper("new setup.Cycle("+JSON.stringify(this.revive())+", "+this.stack+")")},current:function(){return this.phases[Math.trunc(this.stack/this.period)%this.phases.length]},length:function(){return this.period*this.phases.length},turns:function(){return this.period/this.increment},turnsTotal:function(){return this.length()/this.increment},update:function(e){e=Number(e),Number.isNaN(e)&&(e=this.increment);var t=this.current();return this.stack+=e,this.stack<0&&(this.stack=0),Number.isInteger(this.stack)||(this.stack=Math.trunc(this.stack)),t!==this.current()&&a._emit("change"),this},reset:function(){return this.stack=0,a._emit(this,"reset"),this.update(0)},suspend:function(){var e=this.active;return this.active=!1,e!==this.active&&a._emit(this,"suspend"),this},resume:function(){var e=this.active;return this.active=!0,e!==this.active&&a._emit(this,"resume"),this},toggle:function(){return this.active?this.suspend():this.resume(),this},isSuspended:function(){return!this.active},editIncrement:function(e){return e=Number(e),(!Number.isNaN(e)||0<e)&&(Number.isInteger(e)||(e=Math.trunc(e)),this.increment=e),this.increment}}),postdisplay[s]=function(){var e;tags().includes(r)||e?e=!1:tags().includes(i)?e=!0:Object.keys(n()).forEach(function(e){var t=a.get(e);t.active&&t.update()})},setup.Cycle=a,t&&(window.Cycle=window.Cycle||a),Macro.add("newcycle",{tags:["phase"],handler:function(){if(this.args.length<1)return this.error("A cycle must at least be given a name.");if(this.payload.length<2)return this.error("A cycle must be given at least two phases.");var e=this.payload.slice(1).map(function(e){return function(e){if(e.args.length<1)return null;var t=e.args.flatten();return t.every(function(e){return"string"==typeof e})?t:null}(e)}).flatten();if(e.includes(null))return this.error("Each `<<phase>>` tag must be given a valid name.");try{a.add(this.args[0],{phases:e,period:this.args[1],increment:this.args[2],active:this.args[3]&&"string"==typeof this.args[3]&&"suspend"!==this.args[3].trim()})}catch(e){var t=e.message&&e.message.split("->")[1];return t=!!t&&t.trim(),this.error(t||e.message)}}}),Macro.add("editcycle",{handler:function(){if(this.args.length<1||"string"!=typeof this.args[0]||!this.args[0].trim())return this.error("You must name the cycle you wish to act on.");if(this.args.length<2)return this.error("You must provide an action to perform.");var e=a.get(this.args[0]);if(null===e)return this.error('Cannot find a cycle named "'+this.args[0]+'".');if(this.args.includes("suspend")?e.suspend():this.args.includes("toggle")?e.toggle():this.args.includes("resume")&&e.resume(),this.args.includes("increment")){var t=this.args[this.args.indexOf("increment")+1];"number"==typeof t&&e.editIncrement(t)}if(this.args.includesAny("reset","clear")&&e.reset(),this.args.includes("change")){var r=this.args[this.args.indexOf("change")+1];r=Number(r),!Number.isNaN(r)&&Number.isInteger(r)&&e.update(r)}}}),Macro.add("showcycle",{handler:function(){if(this.args.length<1||"string"!=typeof this.args[0]||!this.args[0].trim())return this.error("You must name the cycle you wish to act on.");var e=a.get(this.args[0]);if(null===e)return this.error('Cannot find a cycle named "'+this.args[0]+'".');var t=e.current();this.args.includes("uppercase")?t=t.toUpperCase():this.args.includes("lowercase")?t=t.toLowerCase():this.args.includes("upperfirst")&&(t=t.toUpperFirst()),$(document.createElement("span")).addClass("macro-"+this.name).append(t).appendTo(this.output)}})}();
// end cycles.min.js
// first-macro.min.js, for SugarCube 2, by Chapel
;Macro.add("first",{skipArgs:!0,tags:["then","finally"],handler:function(){var a,t=$(document.createElement("span")),n=this.payload[this.payload.length-1],s=visited()-1;a=s<this.payload.length?this.payload[s].contents:"finally"===n.name?n.contents:"",t.wiki(a).addClass("macro-"+this.name).appendTo(this.output)}});
// end first-macro.min.js
// fs.min.js, for SugarCube 2, by Chapel
;!function(){function i(t){return console.error(t),null}function a(t){try{return JSON.stringify(t)}catch(t){return i(t)}}function s(t){try{var e;if(void 0===t)return null;if(null!=(e="string"!=typeof t?a(t):t))return LZString.compressToBase64(e)}catch(t){return i(t)}}function o(t){try{return LZString.decompressFromBase64(t)}catch(t){return i(t)}}function c(e){try{return JSON.parse(e)}catch(t){try{return JSON.parse(o(e))}catch(t){return i(t)}}}function u(t,e){try{if("$"!==e[0]&&"_"!==e[0])throw new Error("Invalid stateful variable");State.setVar?State.setVar(e,clone(t)):"$"===e[0]?State.variables[e.substr(1)]=clone(t):State.temporary[e.substr(1)]=clone(t)}catch(t){return i(t)}}function l(t,e){if("string"!=typeof e&&(e=a(e)),null!=e){(t=t&&"string"==typeof t?Util.slugify(t.trim()).toLowerCase():"file.twinedata").includes(".")||(t+=".twinedata");try{saveAs(new Blob([e],{type:"text/plain;charset=UTF-8"}),t)}catch(t){return i(t)}}}function f(t){var e=t.target.files[0],r=new FileReader,n=t.storyVar||"$fileData",a=t.dataType||"text";$(r).on("load",function(t){try{var e=t.currentTarget;if(!e.result)return;u(function(t,e){if(null==e)return null;switch(t){case"json":return c(e);case"base64":case"b64":case"64":return c(o(e));default:return e}}(a,e.result),n)}catch(t){return i(t)}}),r.readAsText(e)}function p(t,e,r,n,a){var i,s=function(t,e,r,n){var a=$(document.createElement(n?"a":"button")).wiki(t),i=$(document.createElement("label")).attr("for","file-import").addClass("upload-file").append(a),s=$(document.createElement("input")).attr({id:"file-import",type:"file","data-format":r}).css("display","none").on("change",function(t){f(Object.assign(clone(t),{storyVar:e,dataType:$(this).attr("data-format")}))}),o=$(document.createElement("span")).append(i,s);return a.ariaClick(function(){i.trigger("click")}),o}(e,r,n,a);i=t&&"string"==typeof t?$(t):t||"#passages",s.appendTo(i)}setup.fileSystem={config:{defaultText:"Import",renderAsLink:!1},JSON:{stringify:a,parse:c},b64:{compress:s,decompress:o},toState:u,toFile:l,fromFile:f},window.Chapel=window.Chapel||{},Chapel.fileSystem=Chapel.fileSystem||setup.fileSystem,Macro.add("import",{handler:function(){var t=this.output,e=this.args[2],r=this.args[0],n=this.args[1];if(e&&"string"==typeof e||(e=setup.fileSystem.config.defaultText),!r||"string"!=typeof r||"$"!==r[0]&&"_"!==r[0])return this.error("Invalid variable name.");p(t,e,r,n=n&&"string"==typeof n?n.trim():"text",setup.fileSystem.config.renderAsLink)}}),Macro.add("export",{handler:function(){var t=this.args[0],e=this.args[1],r=this.args[2];if(!t)return this.error("No data to save...");r=r&&"string"==typeof r?r.trim():"text",function(t,e,r){var n;switch(r){case"json":n=a(t);break;case"base64":case"b64":case"64":n=s(a(t)||t);break;default:n="string"==typeof t?t:a(t)}l(e,n)}(t,e=e&&"string"==typeof e?e.trim():"file.twinedata",r)}})}();
// end fs.min.js
// operations.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var r=r||{},e=!0,t=!0,i=[0,100];function o(r,e){var t,i=[],o=0,n=1;if("string"==typeof r)i=r.split("d");else if("number"==typeof r&&e)i=[r,e];else{if(!(Array.isArray(r)&&2<=r.length))throw new TypeError("dice(): could not process arguments...");r.length=2,i=r}if(i[0]=Number(i[0]),"string"==typeof i[1]&&"F"===i[1].trim().toUpperCase()?(i[1]=3,n=-1):i[1]=Number(i[1]),i.some(function(r){return Number.isNaN(r)}))throw new TypeError("dice(): could not process arguments...");for(t=0;t<i[0];t++){o+=Math.floor(State.random()*i[1])+n}return o}function n(r,e){if("string"!=typeof r)return o(r,e);var t=function(r){var e;return[(e=(r=r.trim().replace(/\s/g,"")).match(/(\d+[d][\df]d*)(.*)/i))[1],Number(e[2])]}(r);return o(t[0])+t[1]}r.dice={roll:n},e&&(window.dice=window.dice||n),Number.prototype.dice||Object.defineProperty(Number.prototype,"dice",{configurable:!0,writable:!0,value:function(r){if(0===this)return 0;if(this<0)throw new TypeError("Number.prototype.dice: cannot roll a negative number of dice!");if("string"!=typeof r&&"F"!==r.trim().toUpperCase()&&(null==r||"number"!=typeof r||r<=0||!Number.isInteger(r)))throw new TypeError("Number.prototype.dice: error in argument");if(!Number.isInteger(this))throw new TypeError("Number.prototype.dice: cannot roll partial dice!");return n(this,r)}}),Number.prototype.fairmath||Object.defineProperty(Number.prototype,"fairmath",{configurable:!0,writable:!0,value:function(r){var e=i;if(this<e[0]||this>e[1])throw new TypeError("Number.prototype.fairmath called on a number that is out of the defined range (the number was "+this+").");if(null==r||"number"!=typeof r||100<r||r<-100||arguments.length<1)throw new TypeError("Number.prototype.fairmath given incorrect argument or an argument that is out of the valid 0-100 range.");if(0===r)return Math.clamp(Math.trunc(this),e[0],e[1]);if(r<0)return r*=-1,Math.clamp(Math.trunc(this-(this-e[0])*(r/e[1])),e[0],e[1]);if(0<r)return Math.clamp(Math.trunc(this+(e[1]-this)*(r/e[1])),e[0],e[1]);throw new Error("Number.prototype.fairmath encountered an unspecified error.")}}),Math.fairmath||Object.defineProperty(Math,"fairmath",{configurable:!0,writable:!0,value:function(r,e){return r.fairmath(e)}}),t&&(Math.fm||Object.defineProperty(Math,"fm",{configurable:!0,writable:!0,value:function(r,e){return r.fairmath(e)}}),Number.prototype.fm||Object.defineProperty(Number.prototype,"fm",{configurable:!0,writable:!0,value:function(r){return this.fairmath(r)}}),Number.prototype.d||Object.defineProperty(Number.prototype,"d",{configurable:!0,writable:!0,value:function(r){return this.dice(r)}}))}();
// end operations.min.js
// swap-macro-set.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var o={tryGlobal:!0,resetButton:!0,normal:"violet",selected:"red",cls:"swappable"};setup.swap=setup.swap||{};var l=null;function i(t){function a(){return t}setup.swap.current=a,o.tryGlobal&&(window.swapCurrent=a)}function r(t,a){var e=$(document.createElement("span"));return $(document.createElement("a")).wiki(t).css("color",o.normal).attr({"data-swap-flag":"false","data-orig-content":t,"data-wiki-code":a||""}).addClass(o.cls).appendTo(e).ariaClick(function(t){t.preventDefault();var a=$(this);if("true"===a.attr("data-swap-flag"))a.attr("data-swap-flag","false").css("color",o.normal),l=null;else if(l){var e=l.text(),s=a.text(),r=l.attr("data-wiki-code"),n=a.attr("data-wiki-code");l.attr("data-swap-flag","false").css("color",o.normal).empty().wiki(s),a.attr("data-swap-flag","false").css("color",o.normal).empty().wiki(e),r&&"string"==typeof r&&r.trim()&&(i(s),$.wiki(r)),n&&"string"==typeof n&&n.trim()&&(i(e),$.wiki(n)),setup.swap.current&&"function"==typeof setup.swap.current&&delete setup.swap.current,o.tryGlobal&&window.swapCurrent&&"function"==typeof window.swapCurrent&&delete window.swapCurrent,l=null}else(l=a).attr("data-swap-flag","true").css("color",o.selected)}),e}function a(){l=null,$("a."+o.cls).each(function(){var t=$(this);t.empty().wiki(t.attr("data-orig-content")).attr("data-swap-flag","false").css("color",o.normal)})}Macro.add("swap",{tags:["onswap"],skipArgs:!0,handler:function(){var t=this.payload[0].contents,a=this.payload[1]?this.payload[1].contents:"",e=this.output,s=this.name;r(t,a).addClass("macro-"+s).appendTo(e)}}),Macro.add("resetswap",{handler:function(){var t=this.args&&this.args[0]&&"string"==typeof this.args[0]?this.args[0]:"Reset";$(document.createElement(o.resetButton?"button":"a")).wiki(t).ariaClick({label:"Reset all swappable elements."},function(t){t.preventDefault(),a()}).appendTo(this.output)}}),setup.swap.create=r,setup.swap.reset=a}();
// end swap-macro-set.min.js
// fading-macro-set.min.js, for SugarCube 2, by Chapel
;Macro.add("fadein",{tags:null,handler:function(){var t,a,s=$(document.createElement("span")),e=this.payload[0].contents;if(0===this.args.length)return this.error("no arguments given");t=Util.fromCssTime(this.args[0]),a=1<this.args.length?Util.fromCssTime(this.args[1]):0,s.wiki(e).addClass("macro-"+this.name).appendTo(this.output).hide().delay(a).fadeIn(t)}}),Macro.add("fadeout",{tags:null,handler:function(){var t,a,s=$(document.createElement("span")),e=this.payload[0].contents;if(0===this.args.length)return this.error("no arguments given");t=Util.fromCssTime(this.args[0]),a=1<this.args.length?Util.fromCssTime(this.args[1]):0,s.wiki(e).addClass("macro-"+this.name).appendTo(this.output).delay(a).fadeOut(t)}});
// end fading-macro-set.min.js
// events.min.js, for SugarCube 2, by Chapel
;Macro.add("trigger",{handler:function(){var t;return 2<this.args.length||0===this.args.length?this.error("incorrect number of arguments"):"string"!=typeof this.args[0]?this.error("first argument should be a string and a valid event type"):(t=this.args[0],void(1===this.args.length||this.args[1]&&"string"==typeof this.args[1]&&"document"===this.args[1].toLowerCase().trim()?$(document):$(this.args[1])).trigger(t))}}),Macro.add("event",{tags:["which"],handler:function(){var t,r,s=this.payload,e="",i="";return 2<this.args.length||0===this.args.length?this.error("incorrect number of arguments"):"string"!=typeof this.args[0]?this.error("first argument should be a string and a valid event type"):(2===this.args.length&&"string"==typeof this.args[1]&&(e=this.args[1]),t=this.args[0],void $(document).on(t,e,function(t){if(i=s[0].contents,1<s.length)for(r=1;r<s.length;r++)s[r].args.includes(t.which)&&(i+=s[r].contents);new Wikifier(null,i)}))}});
// end events.min.js
// css-macro.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";function r(){try{var t,r=[].slice.call(arguments).flatten(),e=r.shift();return"string"==typeof r[0]?t=function(e){if(e.length%2!=0)return"Style rules should be a list of key/value pairs; you've passed an odd number.";var n={};return e.forEach(function(t,r){r%2==0&&(n[t]=e[r+1])}),n}(r):"object"==typeof r[0]&&(t=clone(r[0])),function(t,r){try{return"string"==typeof r?r:(t instanceof jQuery||(t=$(t)),t.css(r))}catch(t){return t.message}}(e,t)}catch(t){return t.message}}Macro.add("css",{handler:function(){var t=r(this.args);if("string"==typeof t)return this.error(t)}})}();
// end css-macro.min.js
// message-macro.min.js, for SugarCube 2, by Chapel
;setup.messageMacro={},setup.messageMacro.default="Help",Macro.add("message",{tags:null,handler:function(){var e=this.payload[0].contents,a=$(document.createElement("span")),s=$(document.createElement(this.args.includes("btn")?"button":"a")),t=$(document.createElement("span"));s.wiki(0<this.args.length&&"btn"!==this.args[0]?this.args[0]:setup.messageMacro.default).ariaClick(this.createShadowWrapper(function(){a.hasClass("open")?t.css("display","none").empty():t.css("display","block").wiki(e),a.toggleClass("open")})),a.attr("id","macro-"+this.name+"-"+this.args.join("").replace(/[^A-Za-z0-9]/g,"")).addClass("message-text").append(s).append(t).appendTo(this.output)}});
// end message-macro.min.js
// fullscreen.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var n=document.body;function t(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}function u(e){t()||(e.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen())}function l(){t()&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen())}function c(){t()?l():u(n)}Macro.add("fullscreen",{handler:function(){c()}}),Macro.add("fullscreenlink",{handler:function(){var e,n=$(document.createElement("span")),t=$(document.createElement("a")),u="macro-"+this.name;if(1!==this.args.length)return this.error("incorrect number of arguments");e=this.args[0],t.wiki(e).attr("id","fullscreen-macro-link").ariaClick(function(){c()}),n.append(t).addClass(u).appendTo(this.output)}}),setup.fullscreen=function(e){void 0===e?c():e?u(n):l()},setup.isFullscreen=t}();
// end fullscreen.min.js
// dialog-api-macro-set.min.js, for SugarCube 2, by Chapel
;Macro.add("dialog",{tags:["onopen","onclose"],handler:function(){var n="",o=null,e=null,t=0<this.args.length?this.args[0]:"",s=1<this.args.length?this.args.slice(1).flatten():[];this.payload.forEach(function(t,s){0===s?n=t.contents:"onopen"===t.name?o=o?o+t.contents:t.contents:e=e?e+t.contents:t.contents}),s.push("macro-"+this.name),Dialog.setup(t,s.join(" ")),Dialog.wiki(n),o&&"string"==typeof o&&o.trim()&&$(document).one(":dialogopened",function(){$.wiki(o)}),e&&"string"==typeof e&&e.trim()&&$(document).one(":dialogclosed",function(){$.wiki(e)}),Dialog.open()}}),Macro.add("popup",{handler:function(){if(this.args.length<1)return this.error("need at least one argument; the passage to display");if(!Story.has(this.args[0]))return this.error("the passage "+this.args[0]+"does not exist");var t=this.args[0],s=1<this.args.length?this.args[1]:"",n=2<this.args.length?this.args.slice(2).flatten():[];n.push("macro-"+this.name),Dialog.setup(s,n.join(" ")),Dialog.wiki(Story.get(t).processText()),Dialog.open()}}),Macro.add("dialogclose",{skipArgs:!0,handler:function(){Dialog.close()}});
// end dialog-api-macro-set.min.js
// done.min.js, for SugarCube 2, by Chapel
;!function(){var a=1;Macro.add("done",{skipArgs:!0,tags:null,handler:function(){var n=this.payload[0].contents.trim();""!==n&&(postdisplay[":chapel-done-macro-"+a]=function(a){delete postdisplay[a],$.wiki(n)},a++)}})}();
// end done.min.js
// ui-macro.min.js, for SugarCube 2, by Chapel
;!function(){var r={update:UIBar.setStoryElements,stow:UIBar.stow,unstow:UIBar.unstow,toggle:function(){$("#ui-bar").hasClass("stowed")?UIBar.unstow():UIBar.stow()},hide:function(){$("#ui-bar").css("display","none")},show:function(){$("#ui-bar").css("display","block")},kill:function(){$("#ui-bar").css("display","none"),$("#story").css("margin-left","2.5em")},restore:function(){$("#ui-bar").css("display","block"),$("#story").css("margin-left","20em")},jump:UI.jumpto,saves:UI.saves,restart:UI.restart,settings:UI.settings,share:UI.share,aliases:{refresh:"update",reload:"update",destroy:"kill",revive:"restore",jumpto:"jump",save:"saves",load:"saves",setting:"settings",sharing:"share"}},t=Object.keys(r);function a(s){return s&&"string"==typeof s?function(s){return t.includes(s)}(s=s.toLowerCase().trim())||(s=function(s){return r.aliases[s]||null}(s))?(r[s](),!1):'Command "'+s+'" is not a valid command.':"Command is not a string."}Macro.add("ui",{handler:function(){Array.isArray(this.args)&&this.args.length||this.error("No commands passed to macro.");var s,r=function(s){if(!Array.isArray(s))return"Command list error.";var r=[];return s.forEach(function(s){r.push(a(s))}),r}(this.args.flatten());s=(r=r.filter(function(s){return"string"==typeof s})).join(" "),r.length&&s&&this.error(s)}})}();
// end ui-macro.min.js
// playtime.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var e={tryGlobal:!0,storyVar:"playtime",pauseTag:"pausetimer"};function r(){return Date.now()-State.variables[e.storyVar]}function n(t){if(t&&!(t<0)&&"number"==typeof t){var e=[];return e.push(Math.floor(t/1e3)%60),e.push(Math.floor(t/6e4)%60),e.push(Math.floor(t/36e5)),e}}State.variables[e.storyVar]=Date.now(),predisplay["start-playtime"]=function(t){delete predisplay[t],State.variables[e.storyVar]||(State.variables[e.storyVar]=Date.now())},prehistory["pause-playtime"]=function(t){tags().includes(e.pauseTag)&&(State.variables[e.storyVar]+=time())};var s=["h","hr","hrs","hour","hours"],i=["m","min","mins","minute","minutes"],o=["s","sec","secs","second","seconds"];function u(t){return function(t,e){if(t&&Array.isArray(t)&&!(t.length<3)){var a=t[2]<10?"0"+t[2]:""+t[2],r=t[1]<10?"0"+t[1]:""+t[1],n=t[0]<10?"0"+t[0]:""+t[0];return e?"<b>"+a+":"+r+"</b>:"+n:a+":"+r+":"+n}}(n(r()),t)}setup.playTime=function(t){return"string"==typeof t?function(t){var e=r(),a=n(e);return s.includes(t)?a[2]:i.includes(t)?a[1]:o.includes(t)?a[0]:e}(t):u(t)},e.tryGlobal&&(window.playTime=window.playTime||setup.playTime),Macro.add("playtime",{handler:function(){var t=this.args.map(function(t){return String(t).trim().toLowerCase()}),e=$(document.createElement("span")),a=u(t.includesAny(["format","f","fmt","b","bold","true"]));e.wiki(a).addClass("macro-"+this.name).appendTo(this.output)}})}();
// end playtime.min.js
// meters.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var t=!0,o=!1,l=!1,h={full:"#2ECC40",empty:"#FF4136",back:"#DDDDDD",height:"12px",width:"180px",animate:400,easing:"swing",text:"#111111",label:"",align:"center"},g=["center","left","right"],u=["swing","linear"];function c(t,e){return t&&"string"==typeof t&&(t=t.toLowerCase().trim())?t:e||""}function m(t){return t<.5?2*t*t:(4-2*t)*t-1}function f(t,e){if(!(this instanceof f))return new f(t,e);var s=clone(h);this.settings=Object.assign(s,t),this.settings.align=c(this.settings.align),this.settings.easing=c(this.settings.easing),g.includes(this.settings.align)||(this.settings.align="center"),u.includes(this.settings.easing)||(this.settings.easing="swing"),e=Number(e),Number.isNaN(e)&&(e=1),e=Math.clamp(e,0,1),this.value=e;var i=$(document.createElement("div")).addClass("chapel-meter").attr({"data-val":e,"data-label":this.settings.label}).css({position:"relative","background-color":this.settings.back,height:this.settings.height,width:this.settings.width,overflow:"hidden"}),n=$(document.createElement("div")).addClass("meter-label").css({top:0,right:0,"font-size":this.settings.height,"font-weight":"bold","line-height":"100%",width:"100%",height:"100%","vertical-align":"middle","text-align":this.settings.align,color:this.settings.text,"z-index":1,position:"relative",bottom:"100%"}).wiki(this.settings.label).appendTo(i),r=$(document.createElement("div")).addClass("meter-top").css({"background-color":this.settings.full,opacity:m(this.value),width:"100%",height:"100%","z-index":0}),a=$(document.createElement("div")).addClass("meter-bottom").css({position:"absolute",top:0,left:0,"background-color":this.settings.empty,opacity:1,width:100*this.value+"%",height:"100%","z-index":0}).append(r).appendTo(i);this.$element=i,this.$bars={top:r,bottom:a},(this.$label=n).css("font-size",parseInt(i.css("height"),10)<parseInt($(".passage").css("font-size"),10)?i.css("height"):$(".passage").css("font-size")),n.css("line-height",i.css("height"))}Object.assign(f,{_list:new Map,is:function(t){return t instanceof f},has:function(t){return f._list.has(t)&&f.is(f._list.get(t))},get:function(t){return f.has(t)?f._list.get(t):null},del:function(t){f.has(t)&&f._list.delete(t)},add:function(t,e,s){if(!f.has(t)||o){var i=new f(e,s);return f._list.set(t,i),i}console.error('Meter "'+t+'" already exists.')},_emit:function(t,e){f.is(t)&&t.$element.trigger({type:":"+e,meter:t})}}),Object.assign(f.prototype,{constructor:f,_label:function(t){var e=this;function s(){e.$label.empty().wiki(e.settings.label),e.$label.css("font-size",parseInt(e.$element.css("height"),10)<parseInt(e.$element.parent().css("font-size"),10)?e.$element.css("height"):e.$element.parent().css("font-size")),e.$label.css("line-height",e.$element.css("height"))}return t?setTimeout(s,Engine.minDomActionDelay):s(),this},_width:function(){var t=this;return this.$bars.bottom.animate({width:100*this.value+"%"},this.settings.animate,this.settings.easing,function(){f._emit(t,"meter-animation-complete")}),this},_color:function(){return this.$bars.top.animate({opacity:m(this.value)},this.settings.animate,this.settings.easing),this},animate:function(){return f._emit(this,"meter-animation-start"),this._color()._width()._label()},val:function(t){return void 0!==t&&(t=Number(t),Number.isNaN(t)&&(t=1),t=Math.clamp(t,0,1),this.value=t,this.animate()),this.value},options:function(t){return t&&"object"==typeof t&&Object.assign(this.settings,t),this.settings},unwrap:function(){return this.$element[0]},place:function(t,e){var s=$(document.createElement("span"));return t instanceof jQuery||(t=$(t)),t[0]||console.warn("meter#place() -> no valid target"),e&&"object"==typeof e&&(e.classes&&(Array.isArray(e.classes)||"string"==typeof e.classes)&&s.addClass(e.classes),e.attr&&"object"==typeof e.attr&&s.attr(e.attr)),t.append(s.append(this.$element)),this._label(!0),this},on:function(t,e){return"function"!=typeof e||t&&"string"==typeof t&&t.trim()&&(t=t.split(" ").map(function(t){return(t=t.split(".")[0])+".userland"}).join(" "),this.$element.on(t,e)),this},one:function(t,e){return"function"!=typeof e||t&&"string"==typeof t&&t.trim()&&(t=t.split(" ").map(function(t){return(t=t.split(".")[0])+".userland"}).join(" "),this.$element.one(t,e)),this},off:function(t){return t=t&&"string"==typeof t&&t.trim()?t.split(" ").map(function(t){return(t=t.split(".")[0])+".userland"}).join(" "):".userland",this.$element.off(t),this},click:function(t,e){return this.$element.ariaClick(t,e),this},clone:function(){return new f(this.settings,this.value)},toJSON:function(){return JSON.reviveWrapper("new setup.Meter("+JSON.stringify(this.settings)+", "+this.value+")")}}),setup.Meter=f,t&&(window.Meter=window.Meter||f),Macro.add("newmeter",{tags:["colors","sizing","animation","label"],handler:function(){if(0<State.length&&!l)return this.error("The `<<newmeter>>` macro must be called in your `StoryInit` special passage. Seriously. No excuses. --Love, Chapel");if(this.args.length<1)return this.error("The `<<newmeter>>` macro requires at least one argument: a meter name.");var t=this.args[0],e=null,s=null,i=null,n=null;if("string"!=typeof t)return this.error("Invalid meter name.");if(t=t.trim(),f.has(t)&&!o)return this.error('Cannot clobber the existing meter "'+t+'".');this.payload.length&&(e=this.payload.find(function(t){return"colors"===t.name}),s=this.payload.find(function(t){return"sizing"===t.name}),i=this.payload.find(function(t){return"animation"===t.name}),n=this.payload.find(function(t){return"label"===t.name}));var r={};if(e){if(!e.args.length)return this.error("No arguments passed to the `<<colors>>` tag.");switch(e.args.length){case 1:r.empty=e.args[0],r.full="transparent";break;case 2:r.full=e.args[0],r.empty=e.args[1];break;default:r.full=e.args[0],r.empty=e.args[1],r.back=e.args[2]}}if(s){if(!s.args.length)return this.error("No arguments passed to the `<<sizing>>` tag.");r.width=s.args[0],s.args[1]&&(r.height=s.args[1])}if(i){if(!i.args.length)return this.error("No arguments passed to the `<<animation>>` tag.");if("boolean"!=typeof i.args[0]||i.args[0]){if("string"!=typeof i.args[0])return this.error("The argument to the `<<animation>>` tag should be `true`, `false`, or a valid CSS time value.");r.animate=Util.fromCssTime(i.args[0])}else r.animate=0;i.args[1]&&["swing","linear"].includes(i.args[1])&&(r.easing=i.args[1])}if(n){var a=n.args[0];if(!a||"string"!=typeof a)return this.error("The labelText argument for the `<<label>>` tag is required.");r.label=a.trim(),n.args[1]&&"string"==typeof n.args[1]&&(r.text=n.args[1]),n.args[2]&&"string"==typeof n.args[2]&&(r.align=n.args[2])}f.add(t,r,this.args[1])}}),Macro.add("showmeter",{handler:function(){if(this.args.length<1)return this.error("This macro requires at least one argument: the meter's name.");var t=this.args[0];if("string"!=typeof t)return this.error("Invalid meter name.");t=t.trim();var e=f.get(t);if(!e||!f.is(e))return this.error('The meter "'+t+'" does not exist.');"number"==typeof this.args[1]&&e.val(this.args[1]),e.place(this.output,{classes:"macro-"+this.name,attr:{id:"meter-"+Util.slugify(t)}})}}),Macro.add("updatemeter",{handler:function(){if(this.args.length<2)return this.error("This macro requires two arguments: the meter's name and a value.");var t=this.args[0];if("string"!=typeof t)return this.error("Invalid meter name.");t=t.trim();var e=f.get(t);if(!e||!f.is(e))return this.error('The meter "'+t+'" does not exist.');e.val(this.args[1])}})}();
// end meters.min.js
// pronouns.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";if(Template&&Template.add&&"function"==typeof Template.add){var c={name:"gender",showSetting:!0,label:"Gender",desc:"",storyVar:"%%gender",default:"female"},e="#setting-control-"+c.name,p={subjective:["she","he","they"],objective:["her","him","them"],possessive:["hers","his","theirs"],determiner:["her","his","their"],reflexive:["herself","himself","themself"],noun:["woman","man","person"]};c.showSetting&&(Setting.addToggle(c.name,{label:c.label,desc:c.desc&&"string"==typeof c.desc&&c.desc.trim()?c.desc.trim():void 0}),$(document).on(":dialogopen :dialogopened",function(){$("#ui-dialog-body").hasClass("settings")&&$(e).parent("div").empty().append($(document.createElement("button")).append("Configure...").ariaClick(function(){m()}))})),Template.add(["he","she","they","He","She","They"],function(){return f(this.name,h().subjective)}),Template.add(["him","her","them","Him","Her","Them"],function(){return f(this.name,h().objective)}),Template.add(["his","hers","theirs","His","Hers","Theirs"],function(){return f(this.name,h().possessive)}),Template.add(["his_","her_","their","His_","Her_","Their"],function(){return f(this.name,h().determiner)}),Template.add(["himself","herself","themself","Himself","Herself","Themself"],function(){return f(this.name,h().reflexive)}),Template.add(["man","woman","person","Man","Woman","Person"],function(){return f(this.name,h().noun)});var t=/^is$/i,r=/^was$/i,a=/oes$/i,n=/^[dl]ies$/i,s=/ies$/i,i=/sses$/i,o=/hes$/i,l=/s$/i,u=/they/i;Macro.add("pronouns",{skipArgs:!0,handler:function(){m()}}),Macro.add("verb",{handler:function(){var e=u.test(h().subjective.trim());if(this.args.length<1)return this.error("Please pass at least a singular third person pronoun to this macro.");this.args.includes("plural")&&(e=!0),this.output.append(function(e,t,r){return r?t&&"string"==typeof t?t:g(e):e}(String(this.args[0]),this.args[1]?String(this.args[1]):null,!!e))}}),setup.gender={pronouns:h,dialog:m,pluralize:g},window.gender=window.gender||setup.gender}else alert("Warning, this version of SugarCube does not include the Template API. Please upgrade to v2.29.0 or higher.");function d(){var e=$(document.createElement("div"));var t,r,a,n,s=Object.keys(p).map(function(e){var t=2;"male"===c.default?t=1:"female"===c.default&&(t=0);var r=State.variables,a=p[e][t];return r[c.storyVar]&&r[c.storyVar][e]&&(a=r[c.storyVar][e]),function(e,t,r){return $(document.createElement("label")).append(e).css("display","block").append($(document.createElement("input")).attr({type:"text",name:t}).css({float:"right","margin-left":"0.2em"}).val(r))}(e.toUpperFirst()+": ","gender-"+e,a)}),i=(t="Presets: ",r="gender-preset",a=["She/Her","He/Him","They/Them"],n=$(document.createElement("select")).attr("name",r).css("float","right"),a.forEach(function(e,t){console.log(t),$(document.createElement("option")).attr("value",String(t)).append(e).appendTo(n)}),$(document.createElement("label")).css("display","block").append(t,n)).on("change",function(){var a=Number($(this).find("select").val());Number.isNaN(a)||s.forEach(function(e){var t=e.find("input"),r=t.attr("name").split("-")[1];t.val(p[r][a])})}),o=i.find("select");State.variables[c.storyVar]?o.val(""):"male"===c.default?o.val("1"):"female"===c.default?o.val("0"):o.val("2");var l,u=$(document.createElement("button")).wiki("Confirm").addClass("gender-confirm").ariaClick({label:"Confirm pronoun selection."},function(){var a=State.variables;a[c.storyVar]={},s.forEach(function(e){var t=e.find("input"),r=t.attr("name").split("-")[1];a[c.storyVar][r]=t.val().trim().toLowerCase()}),$("#ui-dialog-body").hasClass("reopen")&&UI.settings(),Dialog.close()}),d=(l=[i,"<br>"],s.forEach(function(e){l.push(e),l.push("<br>")}),l.push(u),l);return e.append(d)}function m(){!function(e,t,r){var a=!1;Dialog.isOpen()&&$("#ui-dialog-body").hasClass("settings")&&(a=!0),Dialog.close(),Dialog.setup(e,a?r+" reopen":r),Dialog.append(t),Dialog.open()}("Customize Gender",d(),"custom-gender")}function h(){if(State.variables[c.storyVar]&&State.variables[c.storyVar].subjective)return State.variables[c.storyVar];var t=2;"male"===c.default?t=1:"female"===c.default&&(t=0);var r={};return Object.keys(p).forEach(function(e){r[e]=p[e][t]}),r}function f(e,t){return e.first()===e.first().toUpperCase()?t.toUpperFirst():t}function g(e){return e&&"string"==typeof e?(e=e.trim(),t.test(e)?e.replace(t,"are"):r.test(e)?e.replace(r,"were"):a.test(e)?e.replace(a,"o"):n.test(e)?e.replace(s,"ie"):s.test(e)?e.replace(s,"y"):i.test(e)?e.replace(i,"ss"):o.test(e)?e.replace(o,"h"):l.test(e)?e.replace(l,""):e):e}}();
// end pronouns.min.js
// articles.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";var t=new Map,i=["eunuch","eucalyptus","eugenics","eulogy","euphemism","euphony","euphoria","eureka","european","euphemistic","euphonic","euphoric","euphemistically","euphonically","euphorically","heir","heiress","herb","homage","honesty","honor","honour","hour","honest","honorous","honestly","hourly","one","ouija","once","ubiquitous","ugandan","ukrainian","unanimous","unicameral","unified","unique","unisex","universal","urinal","urological","useful","useless","usurious","usurped","utilitarian","utopic","ubiquitously","unanimously","unicamerally","uniquely","universally","urologically","usefully","uselessly","usuriously"],a=["a","an"],n=/[aeiou8]/i,u=/[A-Z]+$/,o=/[UFHLMNRSX]/,s=/[.,\/#!$%\^&\*;:{}=\-_`~()]/g;function l(e){return"a"===e?"an":"a"}function r(e,r,i){var n;return 0<State.length?(n="cannot add article override -> needs to be run in StoryInit special passage or earlier",console.error(n),n):r&&"string"==typeof r?(e&&"string"==typeof e&&(e=e.toLowerCase().trim()),a.includes(e)?(r=r.trim(),void(i?t.add(r,{article:e,caseSensitive:!!i}):t.add(r.toLowerCase(),{article:e,caseSensitive:!!i}))):(n='cannot add article override -> invalid article, must be "a" or "an"',console.error(n),n)):(n="cannot add article override -> invalid word",console.error(n),n)}function c(e){var r;return r=n.test(e.first())?"an":"a",function(e,r){return!!i.includes(e.toLowerCase())&&l(r)}(e,r)||function(e,r){return!(!u.test(e)||!o.test(e.first()))&&l(r)}(e,r)||r}function h(e){if(e&&"string"==typeof e){var r=e.trim().split(" ")[0].trim();return function(e){var r=(e=e.trim()).toLowerCase();if(t.has(r)||t.has(e)){var i=t.get(r)||t.get(e);return i.caseSensitive&&!t.has(e)?null:i.article}return null}(r=r.replace(s,""))||c(r)}}function d(e,r){if(!e||"string"!=typeof e)return e;var i=h(e);return(r?i.toUpperFirst():i)+" "+e}setup.articles={find:h,output:d,override:r},Macro.add("setarticle",{handler:function(){var e=r(this.args[0],this.args[1],this.args[2]);e&&"string"==typeof e&&this.error(e)}}),Macro.add(["a","an","A","An"],{handler:function(){var e=this.name.first()===this.name.first().toUpperCase();this.output.append(d(String(this.args[0]),e))}})}();
// end articles.min.js